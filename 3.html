<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body>



<ul id="index">
  <li><a href="#Comments">Comments</a>
    <ul>
      <li><a href="#open-F-ARGV-0-die">open F, $ARGV[0] || die $!;</a></li>
      <li><a href="#my-lines-F">my @lines = &lt;F&gt;;</a></li>
      <li><a href="#my-words-map-split-s-lines">my @words = map {split /\s/} @lines;</a></li>
    </ul>
  </li>
  <li><a href="#Improved-code">Improved code</a></li>
</ul>

<h1 id="Comments">Comments</h1>

<h2 id="open-F-ARGV-0-die"><code>open F, $ARGV[0] || die $!;</code></h2>

<p>Two-argument form of <code>open</code> used. So it can be exploited to start a process or rewrite a file:</p>

<pre><code>  perl wc.pl &#39;echo |&#39;
  perl wc.pl &#39;&gt;test.txt&#39;</code></pre>

<p><code>||</code> operator has a bigger priority than a function call. So code is equal to</p>

<pre><code>  open F, ($ARGV[0] || die $!);</code></pre>

<p>which is unlikely to be expected because error reporting idiom looks like</p>

<pre><code>  open(F, $ARGV[0]) or die($!);</code></pre>

<p>It&#39;s also a bad practice to use global filehandles.</p>

<h2 id="my-lines-F"><code>my @lines = &lt;F&gt;;</code></h2>

<p>This code isn&#39;t very memory efficient. While loop will improve the situation for texts with linebreaks.</p>

<pre><code>  while ( defined(my $line = &lt;$fh&gt;) ) {
  }</code></pre>

<h2 id="my-words-map-split-s-lines"><code>my @words = map {split /\s/} @lines;</code></h2>

<p>At least \s+ should be used to skip empty strings(located between \s characters) counting.</p>

<h1 id="Improved-code">Improved code</h1>

<pre><code>  my ($filename) = @ARGV;
  open my $fh, &#39;&lt;&#39;, $filename or die $!;
  my ($lines, $words) = (0, 0);
  while ( defined(my $line = &lt;$fh&gt;) ) {
      $lines++;
      $words += scalar split /\s+/, $line;
  }
  close $fh;
  printf &quot;%8d %8d\n&quot;, $lines, $words;</code></pre>


</body>

</html>


